(function(n){"use strict";n.IntelliFactory={Runtime:{Ctor:function(n,t){return n.prototype=t.prototype,n},Class:function(n,t,i){var u=n,f,r,e;if(t){u=new t;for(f in n)u[f]=n[f]}if(r=function(n){if(n)for(var t in n)this[t]=n[t]},r.prototype=u,i)for(e in i)r[e]=i[e];return r},Clone:function(n){var t={};for(var i in n)t[i]=n[i];return t},NewObject:function(n){for(var i={},t=0;t<n.length;t++)i[n[t][0]]=n[t][1];return i},PrintObject:function(n){var t=n.constructor.name+" { ",i=!0;for(field in n)i?i=!1:t+=", ",t+=field+" = "+n[field];return t+(i?"}":" }")},DeleteEmptyFields:function(n,t){for(var r,i=0;i<t.length;i++)r=t[i],n[r]===void 0&&delete n[r];return n},GetOptional:function(n){return n===void 0?null:{$:1,$0:n}},SetOptional:function(n,t,i){i?n[t]=i.$0:delete n[t]},SetOrDelete:function(n,t,i){i===void 0?delete n[t]:n[t]=i},Apply:function(n,t,i){return n.apply(t,i)},Bind:function(n){return function(){return n.apply(this,arguments)}},CreateFuncWithArgs:function(n){return function(){return n(Array.prototype.slice.call(arguments))}},CreateFuncWithOnlyThis:function(n){return function(){return n(this)}},CreateFuncWithThis:function(n){return function(){return n(this).apply(null,arguments)}},CreateFuncWithThisArgs:function(n){return function(){return n(this)(Array.prototype.slice.call(arguments))}},CreateFuncWithRest:function(n,t){return function(){return t(Array.prototype.slice.call(arguments,0,n).concat([Array.prototype.slice.call(arguments,n)]))}},CreateFuncWithArgsRest:function(n,t){return function(){return t([Array.prototype.slice.call(arguments,0,n),Array.prototype.slice.call(arguments,n)])}},BindDelegate:function(n,t){var i=n.bind(t);return i.$Func=n,i.$Target=t,i},CreateDelegate:function(n){if(n.length==0)return null;if(n.length==1)return n[0];var t=function(){for(var i,t=0;t<n.length;t++)i=n[t].apply(null,arguments);return i};return t.$Invokes=n,t},CombineDelegates:function(n){for(var t,i=[],r=0;r<n.length;r++)t=n[r],t&&("$Invokes"in t?i=i.concat(t.$Invokes):i.push(t));return IntelliFactory.Runtime.CreateDelegate(i)},DelegateEqual:function(n,t){var f,e,i,r,u;if(n===t)return!0;if(n==null||t==null||(f=n.$Invokes||[n],e=t.$Invokes||[t],f.length!=e.length))return!1;for(i=0;i<f.length;i++)if(r=f[i],u=e[i],!(r===u||"$Func"in r&&"$Func"in u&&r.$Func===u.$Func&&r.$Target==u.$Target))return!1;return!0},ThisFunc:function(n){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),n.apply(null,t)}},ThisFuncOut:function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(t.shift(),t)}},ParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat([i.slice(n)]))}},ParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat(i[n]))}},ThisParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(null,i.slice(0,n+1).concat([i.slice(n+1)]))}},ThisParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(i.shift(),i.slice(0,n).concat(i[n]))}},Curried:function(n,t,i){return i=i||[],function(r){var u=i.concat([r===void 0?null:r]);return t==1?n.apply(null,u):t==2?function(t){return n.apply(null,u.concat([t===void 0?null:t]))}:IntelliFactory.Runtime.Curried(n,t-1,u)}},Curried2:function(n){return function(t){return function(i){return n(t,i)}}},Curried3:function(n){return function(t){return function(i){return function(r){return n(t,i,r)}}}},UnionByType:function(n,t,i){for(var u,f=typeof t,r=0;r<n.length;r++)if(u=n[r],typeof u=="number"){if(Array.isArray(t)&&(u==0||t.length==u))return{$:r,$0:t}}else if(u==f)return{$:r,$0:t};if(!i)throw new Error("Type not expected for creating Choice value.");},ScriptBasePath:"./",ScriptPath:function(n,t){return this.ScriptBasePath+(this.ScriptSkipAssemblyDir?"":n+"/")+t},OnLoad:function(n){"load"in this||(this.load=[]);this.load.push(n)},Start:function(){function n(n){for(var t=0;t<n.length;t++)n[t]()}"load"in this&&(n(this.load),this.load=[])}}};n.IntelliFactory.Runtime.OnLoad(function(){n.WebSharper&&WebSharper.Activator&&WebSharper.Activator.Activate&&WebSharper.Activator.Activate()});Date.now||(Date.now=function(){return(new Date).getTime()});Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});Object.setPrototypeOf||(Object.setPrototypeOf=function(n,t){return n.__proto__=t,n});n.ignore=function(){};n.id=function(n){return n};n.fst=function(n){return n[0]};n.snd=function(n){return n[1]};n.trd=function(n){return n[2]};n.console||(n.console={count:ignore,dir:ignore,error:ignore,group:ignore,groupEnd:ignore,info:ignore,log:ignore,profile:ignore,profileEnd:ignore,time:ignore,timeEnd:ignore,trace:ignore,warn:ignore})})(self);
/* https://github.com/jonathantneal/closest */
(function(w,p){p=w.Element.prototype
if(!p.matches){p.matches=p.msMatchesSelector||function(s){var m=(this.document||this.ownerDocument).querySelectorAll(s);for(var i=0;m[i]&&m[i]!==e;++i);return!!m[i]}}
if(!p.closest){p.closest=function(s){var e=this;while(e&&e.nodeType==1){if(e.matches(s))return e;e=e.parentNode}return null}}})(self);
(function(){for(var i=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})})();
(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH;b=a.CellularAutomata=a.CellularAutomata||{};c=b.Client=b.Client||{};d=a.StartupCode$cellularAutomata$Client=a.StartupCode$cellularAutomata$Client||{};e=a.WebSharper=a.WebSharper||{};f=e.Obj=e.Obj||{};g=e.UI=e.UI||{};h=g.Var$1=g.Var$1||{};i=g.ListModel=g.ListModel||{};j=e.List=e.List||{};k=j.T=j.T||{};l=e.Operators=e.Operators||{};m=e.Seq=e.Seq||{};n=g.Var=g.Var||{};o=g.HtmlModule=g.HtmlModule||{};p=o.attr=o.attr||{};q=g.View=g.View||{};r=e.Unchecked=e.Unchecked||{};s=g.ConcreteVar=g.ConcreteVar||{};t=g.Snap=g.Snap||{};u=g.Storage=g.Storage||{};v=e.Enumerator=e.Enumerator||{};w=e.JavaScript=e.JavaScript||{};x=w.Pervasives=w.Pervasives||{};y=g.Doc=g.Doc||{};z=g.Client=g.Client||{};A=z.Templates=z.Templates||{};B=e.Arrays=e.Arrays||{};C=g.AttrProxy=g.AttrProxy||{};D=w.JS=w.JS||{};E=e.Concurrency=e.Concurrency||{};F=g.AttrModule=g.AttrModule||{};G=g.Abbrev=g.Abbrev||{};H=G.Fresh=G.Fresh||{};I=u.ArrayStorage=u.ArrayStorage||{};J=a.EventTarget;K=a.Node;L=e.Collections=e.Collections||{};M=L.Dictionary=L.Dictionary||{};N=a.Object;O=g.Attrs=g.Attrs||{};P=g.DomUtility=g.DomUtility||{};Q=e.Numeric=e.Numeric||{};R=v.T=v.T||{};S=g.Elt=g.Elt||{};T=g.Array=g.Array||{};U=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};V=L.HashSet=L.HashSet||{};W=a.WindowOrWorkerGlobalScope;X=g.Docs=g.Docs||{};Y=E.Scheduler=E.Scheduler||{};Z=g.DynamicAttrNode=g.DynamicAttrNode||{};_0=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};_1=g.DocElemNode=g.DocElemNode||{};_2=a.CharacterData;_3=g.Updates=g.Updates||{};_4=L.DictionaryUtil=L.DictionaryUtil||{};_5=A.Prepare=A.Prepare||{};_6=e.Slice=e.Slice||{};_7=L.KeyCollection=L.KeyCollection||{};_8=g.An=g.An||{};_9=z.Settings=z.Settings||{};_=G.Mailbox=G.Mailbox||{};$=a.StartupCode$WebSharper_Main$Concurrency=a.StartupCode$WebSharper_Main$Concurrency||{};ba=z.Attrs=z.Attrs||{};bb=ba.Dyn=ba.Dyn||{};bc=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};bd=e.Strings=e.Strings||{};be=z.Docs=z.Docs||{};bf=be.RunState=be.RunState||{};bg=be.NodeSet=be.NodeSet||{};bh=g.Anims=g.Anims||{};bi=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bj=e.Queue=e.Queue||{};bk=E.CT=E.CT||{};bl=e.CancellationTokenSource=e.CancellationTokenSource||{};bm=E.AsyncBody=E.AsyncBody||{};bn=g.BindVar=g.BindVar||{};bo=g.String=g.String||{};bp=g.CheckedInput=g.CheckedInput||{};bq=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};br=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};bs=g.AppendList=g.AppendList||{};bt=L.HashSetUtil=L.HashSetUtil||{};bu=e.Char=e.Char||{};bv=g.Easing=g.Easing||{};bw=G.HashSet=G.HashSet||{};bx=be.DomNodes=be.DomNodes||{};by=a.Error;bz=e.OperationCanceledException=e.OperationCanceledException||{};bA=e.Lazy=e.Lazy||{};bB=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};bC=e.LazyExtensionsProxy=e.LazyExtensionsProxy||{};bD=bC.LazyRecord=bC.LazyRecord||{};bE=a.IntelliFactory;bF=bE&&bE.Runtime;bG=a.console;bH=a.Date;c.Main=function(){d.$cctor();return d.Main;};d.$cctor=function(){var bI,bJ,bK,bL;d.$cctor=a.ignore;function bM(bQ){return bQ?1:0;}function bN(bQ,bR){return function(bS){var bT,bU,bV,bW;function bX(bY,bZ){if(bY)if(bZ<2||bZ>3)bV.UpdateMaybe(function(b0){return!b0?null:{$:1,$0:false};});else if(bZ===3)bV.UpdateMaybe(function(){return{$:1,$0:true};});}bT=bS[0];bU=bS[1];bV=h.Create$1(false);bJ.Append([[bQ,bR],bV.get_View()]);q.Sink(function(bY){return bX(bY[0],bY[1]);},(bW=q.Bind(function(bY){var bZ,b0,b1,b2,b3,b4,b5,b6;function b7(cd,ce){return r.Equals(cd,[bQ-1,bR]);}function b8(cd,ce){return r.Equals(cd,[bQ+1,bR]);}function b9(cd,ce){return r.Equals(cd,[bQ,bR-1]);}function b_(cd,ce){return r.Equals(cd,[bQ,bR+1]);}function b$(cd,ce){return r.Equals(cd,[bQ-1,bR-1]);}function ca(cd,ce){return r.Equals(cd,[bQ-1,bR+1]);}function cb(cd,ce){return r.Equals(cd,[bQ+1,bR-1]);}function cc(cd,ce){return r.Equals(cd,[bQ+1,bR+1]);}bZ=bQ===0?q.Const(false):(m.find(function(cd){return b7(cd[0],cd[1]);},bY))[1];b0=bQ===bT-1?q.Const(false):(m.find(function(cd){return b8(cd[0],cd[1]);},bY))[1];b1=bR===0?q.Const(false):(m.find(function(cd){return b9(cd[0],cd[1]);},bY))[1];b2=bR===bU-1?q.Const(false):(m.find(function(cd){return b_(cd[0],cd[1]);},bY))[1];b3=bQ===0||bR===0?q.Const(false):(m.find(function(cd){return b$(cd[0],cd[1]);},bY))[1];b4=bQ===0||bR===bU-1?q.Const(false):(m.find(function(cd){return ca(cd[0],cd[1]);},bY))[1];b5=bQ===bT-1||bR===0?q.Const(false):(m.find(function(cd){return cb(cd[0],cd[1]);},bY))[1];b6=bQ===bT-1||bR===bU-1?q.Const(false):(m.find(function(cd){return cc(cd[0],cd[1]);},bY))[1];return q.Map2(function(cd,ce){return cd+ce;},q.Map2(function(cd,ce){return cd+ce;},q.Map2(function(cd,ce){return bM(cd)+bM(ce);},bZ,b0),q.Map2(function(cd,ce){return bM(cd)+bM(ce);},b2,b1)),q.Map2(function(cd,ce){return cd+ce;},q.Map2(function(cd,ce){return bM(cd)+bM(ce);},b3,b6),q.Map2(function(cd,ce){return bM(cd)+bM(ce);},b4,b5)));},bJ.v),q.Map2(function(bY,bZ){return[bY,bZ];},bI.get_View(),bW)));return y.Element("div",[F.Handler("click",function(){return function(){return bV.Update(function(bY){return!bY;});};}),F.Dynamic("class",q.Map(function(bY){return bY?"gol-box gol-triggered":"gol-box";},bV.get_View()))],[]);};}function bO(bQ,bR){return function(bS){var bT,bU;bT=bS[0];bU=bS[1];return j.init(bR,function(bV){return(function(bW){return bN(bW[0],bW[1]);}([bQ,bV]))([bT,bU]);});};}function bP(bQ,bR){return j.init(bR,function(bS){return y.Element("div",[C.Create("class","gol-row")],(function(bT){return bO(bT[0],bT[1]);}([bS,bR]))([bQ,bR]));});}d.Main=(bI=h.Create$1(false),(bJ=i.Create(function(bQ){return bQ[0];},k.Empty),(bK=[25,25],(bL=y.Element("div",[],[y.Element("div",[],j.ofSeq(m.delay(function(){return bP.apply(null,bK);}))),y.Element("div",[],[y.Button("Start",[],function(){bI.Update(function(bQ){return!bQ;});})])]),(A.LoadLocalTemplates(""),y.RunById("main",bL))))));};f=e.Obj=bF.Class({Equals:function(bI){return this===bI;},GetHashCode:function(){return -1;}},null,f);f.New=bF.Ctor(function(){},f);h=g.Var$1=bF.Class({},f,h);h.Create$1=function(bI){return new s.New(false,t.New({$:2,$0:bI,$1:[]}),bI);};i.Create=function(bI,bJ){return i.CreateWithStorage(bI,u.InMemory(B.ofSeq(bJ)));};i.CreateWithStorage=function(bI,bJ){return new i.New(bI,bJ);};k=j.T=bF.Class({GetEnumerator:function(){return new R.New(this,null,function(bI){var bJ;bJ=bI.s;return bJ.$==0?false:(bI.c=bJ.$0,bI.s=bJ.$1,true);},void 0);},GetEnumerator0:function(){return v.Get(this);}},null,k);k.Empty=new k({$:0});l.FailWith=function(bI){throw new by(bI);};l.KeyValue=function(bI){return[bI.K,bI.V];};m.delay=function(bI){return{GetEnumerator:function(){return v.Get(bI());}};};m.find=function(bI,bJ){var bK;bK=m.tryFind(bI,bJ);return bK==null?l.FailWith("KeyNotFoundException"):bK.$0;};m.tryFind=function(bI,bJ){var bK,bL,bM;bK=v.Get(bJ);try{bL=null;while(bL==null&&bK.MoveNext()){bM=bK.Current();if(bI(bM))bL={$:1,$0:bM};}return bL;}finally{if(typeof bK=="object"&&"Dispose"in bK)bK.Dispose();}};m.distinctBy=function(bI,bJ){return{GetEnumerator:function(){var bK,bL;bK=v.Get(bJ);bL=new V.New$3();return new R.New(null,null,function(bM){var bN,bO;if(bK.MoveNext()){bN=bK.Current();bO=bL.Add(bI(bN));while(!bO&&bK.MoveNext()){bN=bK.Current();bO=bL.Add(bI(bN));}return bO&&(bM.c=bN,true);}else return false;},function(){bK.Dispose();});}};};m.head=function(bI){var bJ;bJ=v.Get(bI);try{return bJ.MoveNext()?bJ.Current():m.insufficient();}finally{if(typeof bJ=="object"&&"Dispose"in bJ)bJ.Dispose();}};m.fold=function(bI,bJ,bK){var bL,bM;bL=bJ;bM=v.Get(bK);try{while(bM.MoveNext())bL=bI(bL,bM.Current());return bL;}finally{if(typeof bM=="object"&&"Dispose"in bM)bM.Dispose();}};m.iter=function(bI,bJ){var bK;bK=v.Get(bJ);try{while(bK.MoveNext())bI(bK.Current());}finally{if(typeof bK=="object"&&"Dispose"in bK)bK.Dispose();}};m.map=function(bI,bJ){return{GetEnumerator:function(){var bK;bK=v.Get(bJ);return new R.New(null,null,function(bL){return bK.MoveNext()&&(bL.c=bI(bK.Current()),true);},function(){bK.Dispose();});}};};m.forall=function(bI,bJ){return!m.exists(function(bK){return!bI(bK);},bJ);};m.max=function(bI){var bJ,bK,bL;bJ=v.Get(bI);try{if(!bJ.MoveNext())m.seqEmpty();bK=bJ.Current();while(bJ.MoveNext()){bL=bJ.Current();if(r.Compare(bL,bK)===1)bK=bL;}return bK;}finally{if(typeof bJ=="object"&&"Dispose"in bJ)bJ.Dispose();}};m.exists=function(bI,bJ){var bK,bL;bK=v.Get(bJ);try{bL=false;while(!bL&&bK.MoveNext())bL=bI(bK.Current());return bL;}finally{if(typeof bK=="object"&&"Dispose"in bK)bK.Dispose();}};m.seqEmpty=function(){return l.FailWith("The input sequence was empty.");};n=g.Var=bF.Class({},f,n);n.New=bF.Ctor(function(){f.New.call(this);},n);j.init=function(bI,bJ){return j.ofArray(B.init(bI,bJ));};j.ofSeq=function(bI){var bJ,bK,bL,bM,bN,bO;if(bI instanceof k)return bI;else if(bI instanceof a.Array)return j.ofArray(bI);else{bJ=v.Get(bI);try{bL=bJ.MoveNext();if(!bL)bK=k.Empty;else{bN=new k({$:1});bM=bN;while(bL){bM.$0=bJ.Current();if(bJ.MoveNext())bM=(bO=new k({$:1}),bM.$1=bO,bO);else bL=false;}bM.$1=k.Empty;bK=bN;}return bK;}finally{if(typeof bJ=="object"&&"Dispose"in bJ)bJ.Dispose();}}};j.ofArray=function(bI){var bJ,bK,bL;bJ=k.Empty;for(bK=B.length(bI)-1,bL=0;bK>=bL;bK--)bJ=new k({$:1,$0:B.get(bI,bK),$1:bJ});return bJ;};j.head=function(bI){return bI.$==1?bI.$0:j.listEmpty();};j.tail=function(bI){return bI.$==1?bI.$1:j.listEmpty();};j.listEmpty=function(){return l.FailWith("The input list was empty.");};p=o.attr=bF.Class({},f,p);i=g.ListModel=bF.Class({Append:function(bI){var bJ,bK,bL,bM;bJ=this;bK=this["var"].Get();bL=this.key(bI);bM=B.tryFindIndex(function(bN){return r.Equals(bJ.key(bN),bL);},bK);if(bM!=null&&bM.$==1)this["var"].Set(this.storage.SSetAt(bM.$0,bI,bK));else this["var"].Set(this.storage.SAppend(bI,bK));this.ObsoleteKey(bL);},ObsoleteKey:function(bI){var bJ,bK;bJ=(bK=null,[this.it.TryGetValue(bI,{get:function(){return bK;},set:function(bL){bK=bL;}}),bK]);if(bJ[0]){t.Obsolete(bJ[1]);this.it.Remove(bI);}},GetEnumerator:function(){return v.Get(this["var"].Get());},GetEnumerator0:function(){return v.Get0(this["var"].Get());}},f,i);i.New=bF.Ctor(function(bI,bJ){i.New$3.call(this,bI,h.Create$1(B.ofSeq(m.distinctBy(bI,bJ.SInit()))),bJ);},i);i.New$3=bF.Ctor(function(bI,bJ,bK){f.New.call(this);this.key=bI;this["var"]=bJ;this.storage=bK;this.v=q.Map(function(bL){return bL.slice();},this["var"].get_View());this.it=new M.New$5();},i);q.Bind=function(bI,bJ){return q.Join(q.Map(bI,bJ));};q.Map2=function(bI,bJ,bK){return q.CreateLazy(function(){return t.Map2(bI,bJ(),bK());});};q.Const=function(bI){var bJ;bJ=t.New({$:0,$0:bI});return function(){return bJ;};};q.Sink=function(bI,bJ){function bK(){t.WhenRun(bJ(),bI,function(){E.scheduler().Fork(bK);});}E.scheduler().Fork(bK);};q.Join=function(bI){return q.CreateLazy(function(){return t.Join(bI());});};q.Map=function(bI,bJ){return q.CreateLazy(function(){return t.Map(bI,bJ());});};q.CreateLazy=function(bI){var bJ;bJ={c:null,o:bI};return function(){var bK,bL;bK=bJ.c;return bK===null?(bK=bJ.o(),bJ.c=bK,(bL=bK.s,bL!=null&&bL.$==0)?bJ.o=null:t.WhenObsoleteRun(bK,function(){bJ.c=null;}),bK):bK;};};q.Map2Unit=function(bI,bJ){return q.CreateLazy(function(){return t.Map2Unit(bI(),bJ());});};r.Equals=function(bI,bJ){var bK,bL,bM,bN;if(bI===bJ)return true;else{bK=typeof bI;if(bK=="object"){if(bI===null||bI===void 0||bJ===null||bJ===void 0||!r.Equals(typeof bJ,"object"))return false;else if("Equals"in bI)return bI.Equals(bJ);else if("Equals"in bJ)return false;else if(bI instanceof a.Array&&bJ instanceof a.Array)return r.arrayEquals(bI,bJ);else if(bI instanceof a.Date&&bJ instanceof a.Date)return r.dateEquals(bI,bJ);else{bL=[true];for(var bO in bI)if(function(bP){bL[0]=!bI.hasOwnProperty(bP)||bJ.hasOwnProperty(bP)&&r.Equals(bI[bP],bJ[bP]);return!bL[0];}(bO))break;if(bL[0]){for(var bP in bJ)if(function(bQ){bL[0]=!bJ.hasOwnProperty(bQ)||bI.hasOwnProperty(bQ);return!bL[0];}(bP))break;}return bL[0];}}else return bK=="function"&&("$Func"in bI?bI.$Func===bJ.$Func&&bI.$Target===bJ.$Target:"$Invokes"in bI&&"$Invokes"in bJ&&r.arrayEquals(bI.$Invokes,bJ.$Invokes));}};r.arrayEquals=function(bI,bJ){var bK,bL;if(B.length(bI)===B.length(bJ)){bK=true;bL=0;while(bK&&bL<B.length(bI)){!r.Equals(B.get(bI,bL),B.get(bJ,bL))?bK=false:void 0;bL=bL+1;}return bK;}else return false;};r.dateEquals=function(bI,bJ){return bI.getTime()===bJ.getTime();};r.Hash=function(bI){var bJ;bJ=typeof bI;return bJ=="function"?0:bJ=="boolean"?bI?1:0:bJ=="number"?bI:bJ=="string"?r.hashString(bI):bJ=="object"?bI==null?0:bI instanceof a.Array?r.hashArray(bI):r.hashObject(bI):0;};r.hashString=function(bI){var bJ,bK,bL;if(bI===null)return 0;else{bJ=5381;for(bK=0,bL=bI.length-1;bK<=bL;bK++)bJ=r.hashMix(bJ,bI[bK].charCodeAt());return bJ;}};r.hashArray=function(bI){var bJ,bK,bL;bJ=-34948909;for(bK=0,bL=B.length(bI)-1;bK<=bL;bK++)bJ=r.hashMix(bJ,r.Hash(B.get(bI,bK)));return bJ;};r.hashObject=function(bI){var bJ,bK;if("GetHashCode"in bI)return bI.GetHashCode();else{bJ=[0];for(var bL in bI)if(function(bM){bJ[0]=r.hashMix(r.hashMix(bJ[0],r.hashString(bM)),r.Hash(bI[bM]));return false;}(bL))break;return bJ[0];}};r.hashMix=function(bI,bJ){return(bI<<5)+bI+bJ;};r.Compare=function(bI,bJ){var bK,bL,bM,bN,bO,bP;if(bI===bJ)return 0;else{bL=typeof bI;switch(bL=="function"?1:bL=="boolean"?2:bL=="number"?2:bL=="string"?2:bL=="object"?3:0){case 0:return typeof bJ=="undefined"?0:-1;case 1:return l.FailWith("Cannot compare function values.");case 2:return bI<bJ?-1:1;case 3:if(bI===null)bM=-1;else if(bJ===null)bM=1;else if("CompareTo"in bI)bM=bI.CompareTo(bJ);else if("CompareTo0"in bI)bM=bI.CompareTo0(bJ);else if(bI instanceof a.Array&&bJ instanceof a.Array)bM=r.compareArrays(bI,bJ);else if(bI instanceof a.Date&&bJ instanceof a.Date)bM=r.compareDates(bI,bJ);else{bN=[0];for(var bQ in bI)if(function(bR){return!bI.hasOwnProperty(bR)?false:!bJ.hasOwnProperty(bR)?(bN[0]=1,true):(bN[0]=r.Compare(bI[bR],bJ[bR]),bN[0]!==0);}(bQ))break;if(bN[0]===0){for(var bR in bJ)if(function(bS){return!bJ.hasOwnProperty(bS)?false:!bI.hasOwnProperty(bS)&&(bN[0]=-1,true);}(bR))break;}bM=bN[0];}return bM;}}};r.compareArrays=function(bI,bJ){var bK,bL;if(B.length(bI)<B.length(bJ))return -1;else if(B.length(bI)>B.length(bJ))return 1;else{bK=0;bL=0;while(bK===0&&bL<B.length(bI)){bK=r.Compare(B.get(bI,bL),B.get(bJ,bL));bL=bL+1;}return bK;}};r.compareDates=function(bI,bJ){return r.Compare(bI.getTime(),bJ.getTime());};q=g.View=bF.Class({},null,q);s=g.ConcreteVar=bF.Class({Update:function(bI){this.Set(bI(this.Get()));},get_View:function(){return this.view;},UpdateMaybe:function(bI){var bJ;bJ=bI(this.Get());if(bJ!=null&&bJ.$==1)this.Set(bJ.$0);},Get:function(){return this.current;},Set:function(bI){if(this.isConst)(function(bJ){return bJ("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(bJ){bG.log(bJ);}));else{t.Obsolete(this.snap);this.current=bI;this.snap=t.New({$:2,$0:bI,$1:[]});}}},n,s);s.New=bF.Ctor(function(bI,bJ,bK){var bL;bL=this;n.New.call(this);this.isConst=bI;this.current=bK;this.snap=bJ;this.view=function(){return bL.snap;};this.id=H.Int();},s);t.Map2=function(bI,bJ,bK){var bL,bM,bN;function bO(bP){var bQ,bR,bS;if(!(bQ=bN.s,bQ!=null&&bQ.$==0||bQ!=null&&bQ.$==2)){bR=t.ValueAndForever(bJ);bS=t.ValueAndForever(bK);if(bR!=null&&bR.$==1)bS!=null&&bS.$==1?bR.$0[1]&&bS.$0[1]?t.MarkForever(bN,bI(bR.$0[0],bS.$0[0])):t.MarkReady(bN,bI(bR.$0[0],bS.$0[0])):void 0;}}bL=bJ.s;bM=bK.s;return bL!=null&&bL.$==0?bM!=null&&bM.$==0?t.New({$:0,$0:bI(bL.$0,bM.$0)}):t.Map2Opt1(bI,bL.$0,bK):bM!=null&&bM.$==0?t.Map2Opt2(bI,bM.$0,bJ):(bN=t.New({$:3,$0:[],$1:[]}),(t.When(bJ,bO,bN),t.When(bK,bO,bN),bN));};t.WhenRun=function(bI,bJ,bK){var bL;bL=bI.s;if(bL==null)bK();else bL!=null&&bL.$==2?(bL.$1.push(bK),bJ(bL.$0)):bL!=null&&bL.$==3?(bL.$0.push(bJ),bL.$1.push(bK)):bJ(bL.$0);};t.Join=function(bI){var bJ;bJ=t.New({$:3,$0:[],$1:[]});t.When(bI,function(bK){var bL;bL=bK();t.When(bL,function(bM){var bN,bO;if((bN=bL.s,bN!=null&&bN.$==0)&&(bO=bI.s,bO!=null&&bO.$==0))t.MarkForever(bJ,bM);else t.MarkReady(bJ,bM);},bJ);},bJ);return bJ;};t.Map=function(bI,bJ){var bK,bL;bK=bJ.s;return bK!=null&&bK.$==0?t.New({$:0,$0:bI(bK.$0)}):(bL=t.New({$:3,$0:[],$1:[]}),(t.When(bJ,function(bM){t.MarkDone(bL,bJ,bI(bM));},bL),bL));};t.WhenObsoleteRun=function(bI,bJ){var bK;bK=bI.s;if(bK==null)bJ();else bK!=null&&bK.$==2?bK.$1.push(bJ):bK!=null&&bK.$==3?bK.$1.push(bJ):void 0;};t.Map2Opt1=function(bI,bJ,bK){return t.Map(function(bL){return bI(bJ,bL);},bK);};t.Map2Opt2=function(bI,bJ,bK){return t.Map(function(bL){return bI(bL,bJ);},bK);};t.ValueAndForever=function(bI){var bJ;bJ=bI.s;return bJ!=null&&bJ.$==0?{$:1,$0:[bJ.$0,true]}:bJ!=null&&bJ.$==2?{$:1,$0:[bJ.$0,false]}:null;};t.MarkForever=function(bI,bJ){var bK,bL,bM,bN;bK=bI.s;if(bK!=null&&bK.$==3){bI.s={$:0,$0:bJ};bL=bK.$0;for(bM=0,bN=B.length(bL)-1;bM<=bN;bM++)(B.get(bL,bM))(bJ);}else void 0;};t.MarkReady=function(bI,bJ){var bK,bL,bM,bN;bK=bI.s;if(bK!=null&&bK.$==3){bI.s={$:2,$0:bJ,$1:bK.$1};bL=bK.$0;for(bM=0,bN=B.length(bL)-1;bM<=bN;bM++)(B.get(bL,bM))(bJ);}else void 0;};t.When=function(bI,bJ,bK){var bL;bL=bI.s;if(bL==null)t.Obsolete(bK);else bL!=null&&bL.$==2?(t.EnqueueSafe(bL.$1,bK),bJ(bL.$0)):bL!=null&&bL.$==3?(bL.$0.push(bJ),t.EnqueueSafe(bL.$1,bK)):bJ(bL.$0);};t.MarkDone=function(bI,bJ,bK){var bL;if(bL=bJ.s,bL!=null&&bL.$==0)t.MarkForever(bI,bK);else t.MarkReady(bI,bK);};t.EnqueueSafe=function(bI,bJ){var bK,bL,bM,bN;bI.push(bJ);if(bI.length%20===0){bK=bI.slice(0);bj.Clear(bI);for(bL=0,bM=B.length(bK)-1;bL<=bM;bL++){bN=B.get(bK,bL);if(typeof bN=="object")(function(bO){if(bO.s)bI.push(bO);}(bN));else(function(bO){bI.push(bO);}(bN));}}else void 0;};t.Copy=function(bI){var bJ,bK,bL;bJ=bI.s;return bJ==null?bI:bJ!=null&&bJ.$==2?(bK=t.New({$:2,$0:bJ.$0,$1:[]}),(t.WhenObsolete(bI,bK),bK)):bJ!=null&&bJ.$==3?(bL=t.New({$:3,$0:[],$1:[]}),(t.When(bI,function(bM){t.MarkDone(bL,bI,bM);},bL),bL)):bI;};t.Map2Unit=function(bI,bJ){var bK,bL,bM;function bN(){var bO,bP,bQ;if(!(bO=bM.s,bO!=null&&bO.$==0||bO!=null&&bO.$==2)){bP=t.ValueAndForever(bI);bQ=t.ValueAndForever(bJ);if(bP!=null&&bP.$==1)bQ!=null&&bQ.$==1?bP.$0[1]&&bQ.$0[1]?t.MarkForever(bM,null):t.MarkReady(bM,null):void 0;}}bK=bI.s;bL=bJ.s;return bK!=null&&bK.$==0?bL!=null&&bL.$==0?t.New({$:0,$0:null}):bJ:bL!=null&&bL.$==0?bI:(bM=t.New({$:3,$0:[],$1:[]}),(t.When(bI,bN,bM),t.When(bJ,bN,bM),bM));};t.WhenObsolete=function(bI,bJ){var bK;bK=bI.s;if(bK==null)t.Obsolete(bJ);else bK!=null&&bK.$==2?t.EnqueueSafe(bK.$1,bJ):bK!=null&&bK.$==3?t.EnqueueSafe(bK.$1,bJ):void 0;};u.InMemory=function(bI){return new I.New(bI);};v.Get=function(bI){return bI instanceof a.Array?v.ArrayEnumerator(bI):r.Equals(typeof bI,"string")?v.StringEnumerator(bI):bI.GetEnumerator();};v.ArrayEnumerator=function(bI){return new R.New(0,null,function(bJ){var bK;bK=bJ.s;return bK<B.length(bI)&&(bJ.c=B.get(bI,bK),bJ.s=bK+1,true);},void 0);};v.StringEnumerator=function(bI){return new R.New(0,null,function(bJ){var bK;bK=bJ.s;return bK<bI.length&&(bJ.c=bI[bK],bJ.s=bK+1,true);},void 0);};v.Get0=function(bI){return bI instanceof a.Array?v.ArrayEnumerator(bI):r.Equals(typeof bI,"string")?v.StringEnumerator(bI):"GetEnumerator0"in bI?bI.GetEnumerator0():bI.GetEnumerator();};x.NewFromSeq=function(bI){var bJ,bK,bL;bJ={};bK=v.Get(bI);try{while(bK.MoveNext()){bL=bK.Current();bJ[bL[0]]=bL[1];}}finally{if(typeof bK=="object"&&"Dispose"in bK)bK.Dispose();}return bJ;};y=g.Doc=bF.Class({},f,y);y.Button=function(bI,bJ,bK){var bL;bL=C.Concat(bJ);return S.New(y.Clickable("button",bK),bL,y.TextNode(bI));};y.RunById=function(bI,bJ){var bK;bK=self.document.getElementById(bI);if(r.Equals(bK,null))l.FailWith("invalid id: "+bI);else y.Run(bK,bJ);};y.Element=function(bI,bJ,bK){var bL,bM;bL=C.Concat(bJ);bM=y.Concat(bK);return S.New(self.document.createElement(bI),bL,bM);};y.TextNode=function(bI){return y.Mk({$:5,$0:self.document.createTextNode(bI)},q.Const());};y.Clickable=function(bI,bJ){var bK;bK=self.document.createElement(bI);bK.addEventListener("click",function(bL){bL.preventDefault();return bJ();},false);return bK;};y.Run=function(bI,bJ){X.LinkElement(bI,bJ.docNode);y.RunInPlace(false,bI,bJ);};y.Concat=function(bI){var bJ;bJ=T.ofSeqNonCopying(bI);return T.TreeReduce(y.get_Empty(),y.Append,bJ);};y.Mk=function(bI,bJ){return new y.New(bI,bJ);};y.RunInPlace=function(bI,bJ,bK){var bL;bL=X.CreateRunState(bJ,bK.docNode);q.Sink(_8.get_UseAnimations()||_9.BatchUpdatesEnabled()?_.StartProcessor(X.PerformAnimatedUpdate(bI,bL,bK.docNode)):function(){X.PerformSyncUpdate(bI,bL,bK.docNode);},bK.updates);};y.Append=function(bI,bJ){return y.Mk({$:0,$0:bI.docNode,$1:bJ.docNode},q.Map2Unit(bI.updates,bJ.updates));};y.get_Empty=function(){return y.Mk(null,q.Const());};y.New=bF.Ctor(function(bI,bJ){f.New.call(this);this.docNode=bI;this.updates=bJ;},y);A.LoadLocalTemplates=function(bI){!A.LocalTemplatesLoaded()?(A.set_LocalTemplatesLoaded(true),A.LoadNestedTemplates(self.document.body,"")):void 0;A.LoadedTemplates().set_Item(bI,A.LoadedTemplateFile(""));};A.LocalTemplatesLoaded=function(){U.$cctor();return U.LocalTemplatesLoaded;};A.set_LocalTemplatesLoaded=function(bI){U.$cctor();U.LocalTemplatesLoaded=bI;};A.LoadNestedTemplates=function(bI,bJ){var bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX;function bK(bY){var bZ,b0;if(!bL.ContainsKey(bY)){bZ=(b0=null,[bM.TryGetValue(bY,{get:function(){return b0;},set:function(b1){b0=b1;}}),b0]);if(bZ[0]){bX.Add(bY);bM.Remove(bY);A.PrepareTemplateStrict(bJ,{$:1,$0:bY},bZ[1],{$:1,$0:bK});}else bG.warn(bX.Contains(bY)?"Encountered loop when instantiating "+bY:"Local template does not exist: "+bY);}}bL=A.LoadedTemplateFile(bJ);bM=new M.New$5();bN=bI.querySelectorAll("[ws-template]");for(bO=0,bP=bN.length-1;bO<=bP;bO++){bQ=bN[bO];bR=bQ.getAttribute("ws-template").toLowerCase();bQ.removeAttribute("ws-template");bM.set_Item(bR,A.FakeRootSingle(bQ));}bS=bI.querySelectorAll("[ws-children-template]");for(bT=0,bU=bS.length-1;bT<=bU;bT++){bV=bS[bT];bW=bV.getAttribute("ws-children-template").toLowerCase();bV.removeAttribute("ws-children-template");bM.set_Item(bW,A.FakeRoot(bV));}bX=new V.New$3();while(bM.count>0)bK(m.head(bM.get_Keys()));};A.LoadedTemplates=function(){U.$cctor();return U.LoadedTemplates;};A.LoadedTemplateFile=function(bI){var bJ,bK,bL;bJ=(bK=null,[A.LoadedTemplates().TryGetValue(bI,{get:function(){return bK;},set:function(bM){bK=bM;}}),bK]);return bJ[0]?bJ[1]:(bL=new M.New$5(),(A.LoadedTemplates().set_Item(bI,bL),bL));};A.FakeRootSingle=function(bI){var bJ,bK,bL,bM;bI.removeAttribute("ws-template");bJ=bI.getAttribute("ws-replace");if(bJ===null);else{bI.removeAttribute("ws-replace");bK=bI.parentNode;r.Equals(bK,null)?void 0:(bL=self.document.createElement(bI.tagName),bL.setAttribute("ws-replace",bJ),bK.replaceChild(bL,bI));}bM=self.document.createElement("div");bM.appendChild(bI);return bM;};A.FakeRoot=function(bI){var bJ;bJ=self.document.createElement("div");while(bI.hasChildNodes())bJ.appendChild(bI.firstChild);return bJ;};A.PrepareTemplateStrict=function(bI,bJ,bK,bL){var bM;function bN(bT,bU){var bV,bW,bX,bY,bZ,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj;function b0(ck){}while(true)switch(bT){case 0:if(bU!==null){bV=bU.nextSibling;if(r.Equals(bU.nodeType,K.TEXT_NODE))_5.convertTextNode(bU);else if(r.Equals(bU.nodeType,K.ELEMENT_NODE))bP(bU);bU=bV;}else return null;break;case 1:b1=_6.string(bU.nodeName,{$:1,$0:3},null).toLowerCase();b2=(bW=b1.indexOf("."),bW===-1?[bI,b1]:[_6.string(b1,null,{$:1,$0:bW-1}),_6.string(b1,{$:1,$0:bW+1},null)]);b3=b2[1];b4=b2[0];if(b4!==""&&!A.LoadedTemplates().ContainsKey(b4))return _5.failNotLoaded(b3);else{if(b4===""&&bL!=null)bL.$0(b3);b5=A.LoadedTemplates().get_Item(b4);if(!b5.ContainsKey(b3))return _5.failNotLoaded(b3);else{b6=b5.get_Item(b3);b7=b6.cloneNode(true);b8=new V.New$3();b9=new M.New$5();b_=bU.attributes;for(b$=0,ca=b_.length-1;b$<=ca;b$++){cb=b_.item(b$).name.toLowerCase();b9.set_Item(cb,(cc=b_.item(b$).nodeValue,cc===""?cb:cc.toLowerCase()));if(!b8.Add(cb))bG.warn("Hole mapped twice",cb);}for(cd=0,ce=bU.childNodes.length-1;cd<=ce;cd++){cf=bU.childNodes[cd];if(r.Equals(cf.nodeType,K.ELEMENT_NODE))!b8.Add(cf.nodeName.toLowerCase())?bG.warn("Hole filled twice",b3):void 0;}cg=bU.childNodes.length===1&&r.Equals(bU.firstChild.nodeType,K.TEXT_NODE);if(cg){bY=_5.fillTextHole(b7,bU.firstChild.textContent,b3);((function(ck){return function(cl){if(cl!=null)ck(cl.$0);};}((bZ=function(ck){return function(cl){return ck.Add(cl);};}(b8),function(ck){return b0(bZ(ck));})))(bY));}_5.removeHolesExcept(b7,b8);if(!cg){for(ch=0,ci=bU.childNodes.length-1;ch<=ci;ch++){cj=bU.childNodes[ch];if(r.Equals(cj.nodeType,K.ELEMENT_NODE))cj.hasAttributes()?_5.fillInstanceAttrs(b7,cj):bO(b7,cj);}}_5.mapHoles(b7,b9);_5.fill(b7,bU.parentNode,bU);bU.parentNode.removeChild(bU);return;}}break;}}function bO(bT,bU){var bV,bX,bY;function bW(bZ,b0){var b1;if(bX==="title"&&bU.hasChildNodes()){b1=P.ParseHTMLIntoFakeRoot(bU.textContent);bU.removeChild(bU.firstChild);while(b1.hasChildNodes())bU.appendChild(b1.firstChild);}else null;bP(bU);return _5.fill(bU,bZ,b0);}bX=bU.nodeName.toLowerCase();A.foreachNotPreserved(bT,"[ws-attr-holes]",function(bZ){var b0,b1,b2,b3,b4;b0=bd.SplitChars(bZ.getAttribute("ws-attr-holes"),[" "],1);for(b1=0,b2=b0.length-1;b1<=b2;b1++){b3=B.get(b0,b1);bZ.setAttribute(b3,(b4=new a.RegExp("\\${"+bX+"}","ig"),bZ.getAttribute(b3).replace(b4,bU.textContent)));}});bY=bT.querySelector("[ws-hole="+bX+"]");if(r.Equals(bY,null)){bV=bT.querySelector("[ws-replace="+bX+"]");return r.Equals(bV,null)?null:(bW(bV.parentNode,bV),void bV.parentNode.removeChild(bV));}else{while(bY.hasChildNodes())bY.removeChild(bY.lastChild);bY.removeAttribute("ws-hole");return bW(bY,null);}}function bP(bT){if(!bT.hasAttribute("ws-preserve"))if(bd.StartsWith(bT.nodeName.toLowerCase(),"ws-"))bR(bT);else{_5.convertAttrs(bT);bQ(bT.firstChild);}}function bQ(bT){return bN(0,bT);}function bR(bT){return bN(1,bT);}function bS(bT){var bU,bV,bW,bX;while(true){bU=bT.querySelector("[ws-template]");if(r.Equals(bU,null)){bV=bT.querySelector("[ws-children-template]");if(r.Equals(bV,null))return null;else{bW=bV.getAttribute("ws-children-template");bV.removeAttribute("ws-children-template");A.PrepareTemplateStrict(bI,{$:1,$0:bW},bV,null);bT=bT;}}else{bX=bU.getAttribute("ws-template");(A.PrepareSingleTemplate(bI,{$:1,$0:bX},bU))(null);bT=bT;}}}bM=(bJ==null?"":bJ.$0).toLowerCase();A.LoadedTemplateFile(bI).set_Item(bM,bK);if(bK.hasChildNodes()){bS(bK);bQ(bK.firstChild);}};A.foreachNotPreserved=function(bI,bJ,bK){P.IterSelector(bI,bJ,function(bL){if(bL.closest("[ws-preserve]")==null)bK(bL);});};A.PrepareSingleTemplate=function(bI,bJ,bK){var bL;bL=A.FakeRootSingle(bK);return function(bM){A.PrepareTemplateStrict(bI,bJ,bL,bM);};};A.TextHoleRE=function(){U.$cctor();return U.TextHoleRE;};B.init=function(bI,bJ){var bK,bL,bM;if(bI<0)l.FailWith("Negative size given.");else null;bK=new a.Array(bI);for(bL=0,bM=bI-1;bL<=bM;bL++)bK[bL]=bJ(bL);return bK;};B.ofSeq=function(bI){var bJ,bK;if(bI instanceof a.Array)return bI.slice();else if(bI instanceof k)return B.ofList(bI);else{bJ=[];bK=v.Get(bI);try{while(bK.MoveNext())bJ.push(bK.Current());return bJ;}finally{if(typeof bK=="object"&&"Dispose"in bK)bK.Dispose();}}};B.tryFindIndex=function(bI,bJ){var bK,bL;bK=null;bL=0;while(bL<bJ.length&&bK==null){bI(bJ[bL])?bK={$:1,$0:bL}:void 0;bL=bL+1;}return bK;};B.ofList=function(bI){var bJ,bK;bK=[];bJ=bI;while(!(bJ.$==0)){bK.push(j.head(bJ));bJ=j.tail(bJ);}return bK;};B.exists=function(bI,bJ){var bK,bL,bM,bN;bK=false;bL=0;bN=B.length(bJ);while(!bK&&bL<bN)if(bI(bJ[bL]))bK=true;else bL=bL+1;return bK;};B.tryPick=function(bI,bJ){var bK,bL,bM;bK=null;bL=0;while(bL<bJ.length&&bK==null){bM=bI(bJ[bL]);if(bM!=null&&bM.$==1)bK=bM;bL=bL+1;}return bK;};B.filter=function(bI,bJ){var bK,bL,bM;bK=[];for(bL=0,bM=bJ.length-1;bL<=bM;bL++)if(bI(bJ[bL]))bK.push(bJ[bL]);return bK;};B.map=function(bI,bJ){var bK,bL,bM;bK=new a.Array(bJ.length);for(bL=0,bM=bJ.length-1;bL<=bM;bL++)bK[bL]=bI(bJ[bL]);return bK;};B.iter=function(bI,bJ){var bK,bL;for(bK=0,bL=bJ.length-1;bK<=bL;bK++)bI(bJ[bK]);};B.foldBack=function(bI,bJ,bK){var bL,bM,bN,bO,bP;bL=bK;bN=bJ.length;for(bO=1,bP=bN;bO<=bP;bO++)bL=bI(bJ[bN-bO],bL);return bL;};B.pick=function(bI,bJ){var bK;bK=B.tryPick(bI,bJ);return bK==null?l.FailWith("KeyNotFoundException"):bK.$0;};B.concat=function(bI){return a.Array.prototype.concat.apply([],B.ofSeq(bI));};B.choose=function(bI,bJ){var bK,bL,bM,bN;bK=[];for(bL=0,bM=bJ.length-1;bL<=bM;bL++){bN=bI(bJ[bL]);if(bN==null);else bK.push(bN.$0);}return bK;};B.create=function(bI,bJ){var bK,bL,bM;bK=new a.Array(bI);for(bL=0,bM=bI-1;bL<=bM;bL++)bK[bL]=bJ;return bK;};B.forall=function(bI,bJ){var bK,bL,bM,bN;bK=true;bL=0;bN=B.length(bJ);while(bK&&bL<bN)if(bI(bJ[bL]))bL=bL+1;else bK=false;return bK;};C=g.AttrProxy=bF.Class({},null,C);C.Create=function(bI,bJ){return O.Static(function(bK){bK.setAttribute(bI,bJ);});};C.Concat=function(bI){var bJ;bJ=T.ofSeqNonCopying(bI);return T.TreeReduce(O.EmptyAttr(),C.Append,bJ);};C.Append=function(bI,bJ){return O.AppendTree(bI,bJ);};D.GetFieldValues=function(bI){var bJ,bK;bJ=[];for(var bL in bI)bJ.push(bI[bL]);return bJ;};E.scheduler=function(){$.$cctor();return $.scheduler;};E.Return=function(bI){return function(bJ){bJ.k({$:0,$0:bI});};};E.Delay=function(bI){return function(bJ){try{(bI(null))(bJ);}catch(bK){bJ.k({$:1,$0:bK});}};};E.Bind=function(bI,bJ){return E.checkCancel(function(bK){bI(bm.New(function(bL){var bM;if(bL.$==0){bM=bL.$0;E.scheduler().Fork(function(){try{(bJ(bM))(bK);}catch(bN){bK.k({$:1,$0:bN});}});}else E.scheduler().Fork(function(){bK.k(bL);});},bK.ct));});};E.Zero=function(){$.$cctor();return $.Zero;};E.Start=function(bI,bJ){var bK,bL;bK=(bL=(E.defCTS())[0],bJ==null?bL:bJ.$0);E.scheduler().Fork(function(){if(!bK.c)bI(bm.New(function(bM){if(bM.$==1)E.UncaughtAsyncError(bM.$0);},bK));});};E.checkCancel=function(bI){return function(bJ){if(bJ.ct.c)E.cancel(bJ);else bI(bJ);};};E.defCTS=function(){$.$cctor();return $.defCTS;};E.UncaughtAsyncError=function(bI){bG.log("WebSharper: Uncaught asynchronous exception",bI);};E.FromContinuations=function(bI){return function(bJ){var bK;function bL(bM){if(bK[0])l.FailWith("A continuation provided by Async.FromContinuations was invoked multiple times");else{bK[0]=true;E.scheduler().Fork(bM);}}bK=[false];bI(function(bM){bL(function(){bJ.k({$:0,$0:bM});});},function(bM){bL(function(){bJ.k({$:1,$0:bM});});},function(bM){bL(function(){bJ.k({$:2,$0:bM});});});};};E.cancel=function(bI){bI.k({$:2,$0:new bz.New(bI.ct)});};F.Handler=function(bI,bJ){return O.Static(function(bK){bK.addEventListener(bI,function(bL){return(bJ(bK))(bL);},false);});};F.Dynamic=function(bI,bJ){return O.Dynamic(bJ,function(bK){return function(bL){return bK.setAttribute(bI,bL);};});};H.Int=function(){H.set_counter(H.counter()+1);return H.counter();};H.set_counter=function(bI){_0.$cctor();_0.counter=bI;};H.counter=function(){_0.$cctor();return _0.counter;};I=u.ArrayStorage=bF.Class({SSetAt:function(bI,bJ,bK){B.set(bK,bI,bJ);return bK;},SAppend:function(bI,bJ){bJ.push(bI);return bJ;},SInit:function(){return this.init;}},f,I);I.New=bF.Ctor(function(bI){f.New.call(this);this.init=bI;},I);B.get=function(bI,bJ){B.checkBounds(bI,bJ);return bI[bJ];};B.length=function(bI){return bI.dims===2?bI.length*bI.length:bI.length;};B.checkBounds=function(bI,bJ){if(bJ<0||bJ>=bI.length)l.FailWith("Index was outside the bounds of the array.");};B.set=function(bI,bJ,bK){B.checkBounds(bI,bJ);bI[bJ]=bK;};M=L.Dictionary=bF.Class({set_Item:function(bI,bJ){this.set(bI,bJ);},ContainsKey:function(bI){var bJ,bK;bJ=this;bK=this.data[this.hash(bI)];return bK==null?false:B.exists(function(bL){return bJ.equals.apply(null,[(l.KeyValue(bL))[0],bI]);},bK);},TryGetValue:function(bI,bJ){var bK,bL,bM;bK=this;bL=this.data[this.hash(bI)];return bL==null?false:(bM=B.tryPick(function(bN){var bO;bO=l.KeyValue(bN);return bK.equals.apply(null,[bO[0],bI])?{$:1,$0:bO[1]}:null;},bL),bM!=null&&bM.$==1&&(bJ.set(bM.$0),true));},Remove:function(bI){return this.remove(bI);},get_Keys:function(){return new _7.New(this);},set:function(bI,bJ){var bK,bL,bM,bN;bK=this;bL=this.hash(bI);bM=this.data[bL];if(bM==null){this.count=this.count+1;this.data[bL]=new a.Array({K:bI,V:bJ});}else{bN=B.tryFindIndex(function(bO){return bK.equals.apply(null,[(l.KeyValue(bO))[0],bI]);},bM);bN==null?(this.count=this.count+1,bM.push({K:bI,V:bJ})):bM[bN.$0]={K:bI,V:bJ};}},remove:function(bI){var bJ,bK,bL,bM;bJ=this;bK=this.hash(bI);bL=this.data[bK];return bL==null?false:(bM=B.filter(function(bN){return!bJ.equals.apply(null,[(l.KeyValue(bN))[0],bI]);},bL),B.length(bM)<bL.length&&(this.count=this.count-1,this.data[bK]=bM,true));},get_Item:function(bI){return this.get(bI);},get:function(bI){var bJ,bK;bJ=this;bK=this.data[this.hash(bI)];return bK==null?_4.notPresent():B.pick(function(bL){var bM;bM=l.KeyValue(bL);return bJ.equals.apply(null,[bM[0],bI])?{$:1,$0:bM[1]}:null;},bK);},GetEnumerator:function(){return v.Get0(this);},GetEnumerator0:function(){return v.Get0(B.concat(D.GetFieldValues(this.data)));}},f,M);M.New$5=bF.Ctor(function(){M.New$6.call(this,[],r.Equals,r.Hash);},M);M.New$6=bF.Ctor(function(bI,bJ,bK){var bL,bM;f.New.call(this);this.equals=bJ;this.hash=bK;this.count=0;this.data=[];bL=v.Get(bI);try{while(bL.MoveNext()){bM=bL.Current();this.set(bM.K,bM.V);}}finally{if(typeof bL=="object"&&"Dispose"in bL)bL.Dispose();}},M);O.Static=function(bI){return new C({$:3,$0:bI});};O.Dynamic=function(bI,bJ){return new C({$:1,$0:new Z.New(bI,bJ)});};O.Updates=function(bI){return T.MapTreeReduce(function(bJ){return bJ.NChanged();},q.Const(),q.Map2Unit,bI.DynNodes);};O.AppendTree=function(bI,bJ){var bK;return bI===null?bJ:bJ===null?bI:(bK=new C({$:2,$0:bI,$1:bJ}),(O.SetFlags(bK,O.Flags(bI)|O.Flags(bJ)),bK));};O.EmptyAttr=function(){bc.$cctor();return bc.EmptyAttr;};O.Insert=function(bI,bJ){var bK,bL,bM;function bN(bO){var bP,bQ;while(true)if(!(bO===null)){if(bO!=null&&bO.$==1)return bK.push(bO.$0);else if(bO!=null&&bO.$==2){bP=bO.$1;bQ=bO.$0;bN(bQ);bO=bP;}else return bO!=null&&bO.$==3?bO.$0(bI):bO!=null&&bO.$==4?bL.push(bO.$0):null;}else return null;}bK=[];bL=[];bN(bJ);bM=bK.slice(0);return bb.New(bI,O.Flags(bJ),bM,bL.length===0?null:{$:1,$0:function(bO){m.iter(function(bP){bP(bO);},bL);}});};O.SetFlags=function(bI,bJ){bI.flags=bJ;};O.Flags=function(bI){return bI!==null&&bI.hasOwnProperty("flags")?bI.flags:0;};O.HasExitAnim=function(bI){var bJ;bJ=2;return(bI.DynFlags&bJ)===bJ;};O.GetExitAnim=function(bI){return O.GetAnim(bI,function(bJ,bK){return bJ.NGetExitAnim(bK);});};O.HasEnterAnim=function(bI){var bJ;bJ=1;return(bI.DynFlags&bJ)===bJ;};O.GetEnterAnim=function(bI){return O.GetAnim(bI,function(bJ,bK){return bJ.NGetEnterAnim(bK);});};O.HasChangeAnim=function(bI){var bJ;bJ=4;return(bI.DynFlags&bJ)===bJ;};O.GetChangeAnim=function(bI){return O.GetAnim(bI,function(bJ,bK){return bJ.NGetChangeAnim(bK);});};O.GetAnim=function(bI,bJ){return _8.Concat(B.map(function(bK){return bJ(bK,bI.DynElem);},bI.DynNodes));};O.Sync=function(bI,bJ){B.iter(function(bK){bK.NSync(bI);},bJ.DynNodes);};P.ParseHTMLIntoFakeRoot=function(bI){var bJ,bK,bL,bM,bN;function bO(bP,bQ){var bR;while(true)if(bQ===0)return bP;else{bR=bQ;bP=bP.lastChild;bQ=bR-1;}}bJ=self.document.createElement("div");return!P.rhtml().test(bI)?(bJ.appendChild(self.document.createTextNode(bI)),bJ):(bK=(bL=P.rtagName().exec(bI),r.Equals(bL,null)?"":B.get(bL,1).toLowerCase()),(bM=(bN=(P.wrapMap())[bK],bN?bN:P.defaultWrap()),(bJ.innerHTML=bM[1]+bI.replace(P.rxhtmlTag(),"<$1></$2>")+bM[2],bO(bJ,bM[0]))));};P.rhtml=function(){bq.$cctor();return bq.rhtml;};P.wrapMap=function(){bq.$cctor();return bq.wrapMap;};P.defaultWrap=function(){bq.$cctor();return bq.defaultWrap;};P.rxhtmlTag=function(){bq.$cctor();return bq.rxhtmlTag;};P.rtagName=function(){bq.$cctor();return bq.rtagName;};P.IterSelector=function(bI,bJ,bK){var bL,bM,bN;bL=bI.querySelectorAll(bJ);for(bM=0,bN=bL.length-1;bM<=bN;bM++)bK(bL[bM]);};P.InsertAt=function(bI,bJ,bK){var bL;if(!(bK.parentNode===bI&&bJ===(bL=bK.nextSibling,r.Equals(bL,null)?null:bL)))bI.insertBefore(bK,bJ);};P.RemoveNode=function(bI,bJ){if(bJ.parentNode===bI)bI.removeChild(bJ);};t.Obsolete=function(bI){var bJ,bK,bL,bM,bN;bK=bI.s;if(bK==null||(bK!=null&&bK.$==2?(bJ=bK.$1,false):bK!=null&&bK.$==3?(bJ=bK.$1,false):true))void 0;else{bI.s=null;for(bL=0,bM=B.length(bJ)-1;bL<=bM;bL++){bN=B.get(bJ,bL);if(typeof bN=="object")(function(bO){t.Obsolete(bO);}(bN));else bN();}}};t.New=function(bI){return{s:bI};};Q.TryParseInt32=function(bI,bJ){return Q.TryParse(bI,-2147483648,2147483647,bJ);};R=v.T=bF.Class({MoveNext:function(){return this.n(this);},Current:function(){return this.c;},Dispose:function(){if(this.d)this.d(this);}},f,R);R.New=bF.Ctor(function(bI,bJ,bK,bL){f.New.call(this);this.s=bI;this.c=bJ;this.n=bK;this.d=bL;},R);S=g.Elt=bF.Class({},y,S);S.New=function(bI,bJ,bK){var bL,bM;bL=X.CreateElemNode(bI,bJ,bK.docNode);bM=_3.Create(bK.updates);return new S.New$1({$:1,$0:bL},q.Map2Unit(O.Updates(bL.Attr),bM.v),bI,bM);};S.New$1=bF.Ctor(function(bI,bJ,bK,bL){y.New.call(this,bI,bJ);this.docNode$1=bI;this.updates$1=bJ;this.elt=bK;this.rvUpdates=bL;},S);T.ofSeqNonCopying=function(bI){var bJ,bK;if(bI instanceof a.Array)return bI;else if(bI instanceof k)return B.ofList(bI);else if(bI===null)return[];else{bJ=[];bK=v.Get(bI);try{while(bK.MoveNext())bJ.push(bK.Current());return bJ;}finally{if(typeof bK=="object"&&"Dispose"in bK)bK.Dispose();}}};T.TreeReduce=function(bI,bJ,bK){var bL;function bM(bN){return function(bO){var bP,bQ;return bO<=0?bI:bO===1&&(bN>=0&&bN<bL)?B.get(bK,bN):(bQ=bO/2>>0,bJ((bM(bN))(bQ),(bM(bN+bQ))(bO-bQ)));};}bL=B.length(bK);return(bM(0))(bL);};T.MapTreeReduce=function(bI,bJ,bK,bL){var bM;function bN(bO){return function(bP){var bQ,bR;return bP<=0?bJ:bP===1&&(bO>=0&&bO<bM)?bI(B.get(bL,bO)):(bR=bP/2>>0,bK((bN(bO))(bR),(bN(bO+bR))(bP-bR)));};}bM=B.length(bL);return(bN(0))(bM);};U.$cctor=function(){U.$cctor=a.ignore;U.LoadedTemplates=new M.New$5();U.LocalTemplatesLoaded=false;U.GlobalHoles=new M.New$5();U.TextHoleRE="\\${([^}]+)}";U.RenderedFullDocTemplate=null;};V=L.HashSet=bF.Class({Add:function(bI){return this.add(bI);},Contains:function(bI){var bJ;bJ=this.data[this.hash(bI)];return bJ==null?false:this.arrContains(bI,bJ);},add:function(bI){var bJ,bK;bJ=this.hash(bI);bK=this.data[bJ];return bK==null?(this.data[bJ]=[bI],this.count=this.count+1,true):this.arrContains(bI,bK)?false:(bK.push(bI),this.count=this.count+1,true);},arrContains:function(bI,bJ){var bK,bL,bM,bN;bK=true;bL=0;bN=bJ.length;while(bK&&bL<bN)if(this.equals.apply(null,[bJ[bL],bI]))bK=false;else bL=bL+1;return!bK;},ExceptWith:function(bI){var bJ;bJ=v.Get(bI);try{while(bJ.MoveNext())this.Remove(bJ.Current());}finally{if(typeof bJ=="object"&&"Dispose"in bJ)bJ.Dispose();}},get_Count:function(){return this.count;},CopyTo:function(bI){var bJ,bK,bL,bM;bJ=0;bK=bt.concat(this.data);for(bL=0,bM=bK.length-1;bL<=bM;bL++)B.set(bI,bL,bK[bL]);},IntersectWith:function(bI){var bJ,bK,bL,bM,bN;bJ=new V.New$4(bI,this.equals,this.hash);bK=bt.concat(this.data);for(bL=0,bM=bK.length-1;bL<=bM;bL++){bN=bK[bL];if(!bJ.Contains(bN))this.Remove(bN);}},Remove:function(bI){var bJ;bJ=this.data[this.hash(bI)];return bJ==null?false:this.arrRemove(bI,bJ)&&(this.count=this.count-1,true);},arrRemove:function(bI,bJ){var bK,bL,bM,bN;bK=true;bL=0;bN=bJ.length;while(bK&&bL<bN)if(this.equals.apply(null,[bJ[bL],bI])){bJ.splice.apply(bJ,[bL,1]);bK=false;}else bL=bL+1;return!bK;},GetEnumerator:function(){return v.Get(bt.concat(this.data));},GetEnumerator0:function(){return v.Get(bt.concat(this.data));}},f,V);V.New$3=bF.Ctor(function(){V.New$4.call(this,[],r.Equals,r.Hash);},V);V.New$4=bF.Ctor(function(bI,bJ,bK){var bL;f.New.call(this);this.equals=bJ;this.hash=bK;this.data=[];this.count=0;bL=v.Get(bI);try{while(bL.MoveNext())this.add(bL.Current());}finally{if(typeof bL=="object"&&"Dispose"in bL)bL.Dispose();}},V);V.New$2=bF.Ctor(function(bI){V.New$4.call(this,bI,r.Equals,r.Hash);},V);X.LinkElement=function(bI,bJ){X.InsertDoc(bI,bJ,null);};X.CreateElemNode=function(bI,bJ,bK){var bL;X.LinkElement(bI,bK);bL=O.Insert(bI,bJ);return _1.New(bL,bK,null,bI,H.Int(),bF.GetOptional(bL.OnAfterRender));};X.InsertDoc=function(bI,bJ,bK){var bL,bM,bN;while(true)if(bJ!=null&&bJ.$==1)return X.InsertNode(bI,bJ.$0.El,bK);else if(bJ!=null&&bJ.$==2){bL=bJ.$0;bL.Dirty=false;bJ=bL.Current;}else if(bJ==null)return bK;else if(bJ!=null&&bJ.$==4)return X.InsertNode(bI,bJ.$0.Text,bK);else if(bJ!=null&&bJ.$==5)return X.InsertNode(bI,bJ.$0,bK);else if(bJ!=null&&bJ.$==6)return B.foldBack(function(bO,bP){return(((bF.Curried3(function(bQ,bR,bS){return bR==null||bR.constructor===N?X.InsertDoc(bQ,bR,bS):X.InsertNode(bQ,bR,bS);}))(bI))(bO))(bP);},bJ.$0.Els,bK);else{bM=bJ.$1;bN=bJ.$0;bJ=bN;bK=X.InsertDoc(bI,bM,bK);}};X.CreateRunState=function(bI,bJ){return bf.New(bg.get_Empty(),X.CreateElemNode(bI,O.EmptyAttr(),bJ));};X.PerformAnimatedUpdate=function(bI,bJ,bK){var bL;return _8.get_UseAnimations()?(bL=null,E.Delay(function(){var bM,bN,bO;bM=bg.FindAll(bK);bN=X.ComputeChangeAnim(bJ,bM);bO=X.ComputeEnterAnim(bJ,bM);return E.Bind(_8.Play(_8.Append(bN,X.ComputeExitAnim(bJ,bM))),function(){return E.Bind(X.SyncElemNodesNextFrame(bI,bJ),function(){return E.Bind(_8.Play(bO),function(){bJ.PreviousNodes=bM;return E.Return(null);});});});})):X.SyncElemNodesNextFrame(bI,bJ);};X.PerformSyncUpdate=function(bI,bJ,bK){var bL;bL=bg.FindAll(bK);X.SyncElemNode(bI,bJ.Top);bJ.PreviousNodes=bL;};X.InsertNode=function(bI,bJ,bK){P.InsertAt(bI,bK,bJ);return bJ;};X.SyncElemNodesNextFrame=function(bI,bJ){function bK(bL){a.requestAnimationFrame(function(){X.SyncElemNode(bI,bJ.Top);bL();});}return _9.BatchUpdatesEnabled()?E.FromContinuations(function(bL,bM,bN){return bK.apply(null,[bL,bM,bN]);}):(X.SyncElemNode(bI,bJ.Top),E.Return(null));};X.ComputeExitAnim=function(bI,bJ){return _8.Concat(B.map(function(bK){return O.GetExitAnim(bK.Attr);},bg.ToArray(bg.Except(bJ,bg.Filter(function(bK){return O.HasExitAnim(bK.Attr);},bI.PreviousNodes)))));};X.ComputeEnterAnim=function(bI,bJ){return _8.Concat(B.map(function(bK){return O.GetEnterAnim(bK.Attr);},bg.ToArray(bg.Except(bI.PreviousNodes,bg.Filter(function(bK){return O.HasEnterAnim(bK.Attr);},bJ)))));};X.ComputeChangeAnim=function(bI,bJ){var bK;function bL(bM){return O.HasChangeAnim(bM.Attr);}bK=function(bM){return bg.Filter(bL,bM);};return _8.Concat(B.map(function(bM){return O.GetChangeAnim(bM.Attr);},bg.ToArray(bg.Intersect(bK(bI.PreviousNodes),bK(bJ)))));};X.SyncElemNode=function(bI,bJ){!bI?X.SyncElement(bJ):void 0;X.Sync(bJ.Children);X.AfterRender(bJ);};X.SyncElement=function(bI){function bJ(bK){function bL(bM){var bN,bO,bP,bQ;while(true){if(bM!=null&&bM.$==0){bO=bM.$1;bP=bM.$0;if(bL(bP))return true;else bM=bO;}else if(bM!=null&&bM.$==2){bQ=bM.$0;if(bQ.Dirty)return true;else bM=bQ.Current;}else return bM!=null&&bM.$==6&&(bN=bM.$0,bN.Dirty||B.exists(bJ,bN.Holes));}}return bL(bK.Children);}O.Sync(bI.El,bI.Attr);if(bJ(bI))X.DoSyncElement(bI);};X.Sync=function(bI){var bJ,bK,bL,bM,bN;while(true){if(bI!=null&&bI.$==1)return X.SyncElemNode(false,bI.$0);else if(bI!=null&&bI.$==2){bL=bI.$0;bI=bL.Current;}else if(bI==null)return null;else if(bI!=null&&bI.$==5)return null;else if(bI!=null&&bI.$==4){bJ=bI.$0;return bJ.Dirty?(bJ.Text.nodeValue=bJ.Value,bJ.Dirty=false):null;}else if(bI!=null&&bI.$==6){bK=bI.$0;B.iter(function(bO){return function(bP){X.SyncElemNode(bO,bP);};}(false),bK.Holes);B.iter(function(bO){O.Sync(bO[0],bO[1]);},bK.Attrs);return X.AfterRender(bK);}else{bM=bI.$1;bN=bI.$0;X.Sync(bN);bI=bM;}}};X.AfterRender=function(bI){var bJ;bJ=bF.GetOptional(bI.Render);if(bJ!=null&&bJ.$==1){bJ.$0(bI.El);bF.SetOptional(bI,"Render",null);}};X.DoSyncElement=function(bI){var bJ,bK,bL;function bM(bN,bO){var bP,bQ,bR,bS;while(true){if(bN!=null&&bN.$==1)return bN.$0.El;else if(bN!=null&&bN.$==2){bQ=bN.$0;if(bQ.Dirty){bQ.Dirty=false;return X.InsertDoc(bJ,bQ.Current,bO);}else bN=bQ.Current;}else if(bN==null)return bO;else if(bN!=null&&bN.$==4)return bN.$0.Text;else if(bN!=null&&bN.$==5)return bN.$0;else if(bN!=null&&bN.$==6){bP=bN.$0;bP.Dirty?bP.Dirty=false:void 0;return B.foldBack(function(bT,bU){return bT==null||bT.constructor===N?bM(bT,bU):bT;},bP.Els,bO);}else{bR=bN.$1;bS=bN.$0;bN=bS;bO=bM(bR,bO);}}}bJ=bI.El;bx.Iter((bK=bI.El,function(bN){P.RemoveNode(bK,bN);}),bx.Except(bx.DocChildren(bI),bx.Children(bI.El,bF.GetOptional(bI.Delimiters))));bM(bI.Children,(bL=bF.GetOptional(bI.Delimiters),bL!=null&&bL.$==1?bL.$0[1]:null));};Y=E.Scheduler=bF.Class({Fork:function(bI){var bJ;bJ=this;this.robin.push(bI);if(this.idle){this.idle=false;a.setTimeout(function(){bJ.tick();},0);}},tick:function(){var bI,bJ,bK;bJ=this;bK=bH.now();bI=true;while(bI)if(this.robin.length===0){this.idle=true;bI=false;}else{(this.robin.shift())();bH.now()-bK>40?(a.setTimeout(function(){bJ.tick();},0),bI=false):void 0;}}},f,Y);Y.New=bF.Ctor(function(){f.New.call(this);this.idle=true;this.robin=[];},Y);Z=g.DynamicAttrNode=bF.Class({NChanged:function(){return this.updates;},NGetExitAnim:function(bI){return _8.get_Empty();},NGetEnterAnim:function(bI){return _8.get_Empty();},NGetChangeAnim:function(bI){return _8.get_Empty();},NSync:function(bI){if(this.dirty){(this.push(bI))(this.value);this.dirty=false;}}},f,Z);Z.New=bF.Ctor(function(bI,bJ){var bK;bK=this;f.New.call(this);this.push=bJ;this.value=void 0;this.dirty=false;this.updates=q.Map(function(bL){bK.value=bL;bK.dirty=true;},bI);},Z);_0.$cctor=function(){_0.$cctor=a.ignore;_0.counter=0;};_1=g.DocElemNode=bF.Class({Equals:function(bI){return this.ElKey===bI.ElKey;},GetHashCode:function(){return this.ElKey;}},null,_1);_1.New=function(bI,bJ,bK,bL,bM,bN){var bO;return new _1((bO={Attr:bI,Children:bJ,El:bL,ElKey:bM},(bF.SetOptional(bO,"Delimiters",bK),bF.SetOptional(bO,"Render",bN),bO)));};_3=g.Updates=bF.Class({},null,_3);_3.Create=function(bI){var bJ;bJ=null;bJ=_3.New(bI,null,function(){var bK;bK=bJ.s;return bK===null?(bK=t.Copy(bJ.c()),bJ.s=bK,t.WhenObsoleteRun(bK,function(){bJ.s=null;}),bK):bK;});return bJ;};_3.New=function(bI,bJ,bK){return new _3({c:bI,s:bJ,v:bK});};_4.notPresent=function(){return l.FailWith("The given key was not present in the dictionary.");};_5.convertTextNode=function(bI){var bJ,bK,bL,bM,bN,bO;bJ=null;bK=0;bM=bI.textContent;bN=new a.RegExp(A.TextHoleRE(),"g");while(bJ=bN.exec(bM),bJ!==null){bI.parentNode.insertBefore(self.document.createTextNode(_6.string(bM,{$:1,$0:bK},{$:1,$0:bN.lastIndex-B.get(bJ,0).length-1})),bI);bK=bN.lastIndex;bO=self.document.createElement("span");bO.setAttribute("ws-replace",B.get(bJ,1).toLowerCase());bI.parentNode.insertBefore(bO,bI);}bN.lastIndex=0;bI.textContent=_6.string(bM,{$:1,$0:bK},null);};_5.failNotLoaded=function(bI){bG.warn("Instantiating non-loaded template",bI);};_5.fillTextHole=function(bI,bJ,bK){var bL;bL=bI.querySelector("[ws-replace]");return r.Equals(bL,null)?(bG.warn("Filling non-existent text hole",bK),null):(bL.parentNode.replaceChild(self.document.createTextNode(bJ),bL),{$:1,$0:bL.getAttribute("ws-replace")});};_5.removeHolesExcept=function(bI,bJ){function bK(bL){A.foreachNotPreserved(bI,"["+bL+"]",function(bM){if(!bJ.Contains(bM.getAttribute(bL)))bM.removeAttribute(bL);});}bK("ws-attr");bK("ws-onafterrender");bK("ws-var");A.foreachNotPreserved(bI,"[ws-hole]",function(bL){if(!bJ.Contains(bL.getAttribute("ws-hole"))){bL.removeAttribute("ws-hole");while(bL.hasChildNodes())bL.removeChild(bL.lastChild);}});A.foreachNotPreserved(bI,"[ws-replace]",function(bL){if(!bJ.Contains(bL.getAttribute("ws-replace")))bL.parentNode.removeChild(bL);});A.foreachNotPreserved(bI,"[ws-on]",function(bL){bL.setAttribute("ws-on",bd.concat(" ",B.filter(function(bM){return bJ.Contains(B.get(bd.SplitChars(bM,[":"],1),1));},bd.SplitChars(bL.getAttribute("ws-on"),[" "],1))));});A.foreachNotPreserved(bI,"[ws-attr-holes]",function(bL){var bM,bN,bO,bP,bQ;bM=bd.SplitChars(bL.getAttribute("ws-attr-holes"),[" "],1);for(bN=0,bO=bM.length-1;bN<=bO;bN++){bP=B.get(bM,bN);bL.setAttribute(bP,(bQ=new a.RegExp(A.TextHoleRE(),"g"),bL.getAttribute(bP).replace(bQ,function(bR,bS){return bJ.Contains(bS)?bR:"";})));}});};_5.fillInstanceAttrs=function(bI,bJ){var bK,bL,bM,bN,bO;_5.convertAttrs(bJ);bK=bJ.nodeName.toLowerCase();bL=bI.querySelector("[ws-attr="+bK+"]");if(r.Equals(bL,null))bG.warn("Filling non-existent attr hole",bK);else{bL.removeAttribute("ws-attr");for(bM=0,bN=bJ.attributes.length-1;bM<=bN;bM++){bO=bJ.attributes.item(bM);if(bO.name==="class"&&bL.hasAttribute("class"))bL.setAttribute("class",bL.getAttribute("class")+" "+bO.nodeValue);else bL.setAttribute(bO.name,bO.nodeValue);}}};_5.mapHoles=function(bI,bJ){function bK(bL){A.foreachNotPreserved(bI,"["+bL+"]",function(bM){var bN,bO;bN=(bO=null,[bJ.TryGetValue(bM.getAttribute(bL).toLowerCase(),{get:function(){return bO;},set:function(bP){bO=bP;}}),bO]);if(bN[0])bM.setAttribute(bL,bN[1]);});}bK("ws-hole");bK("ws-replace");bK("ws-attr");bK("ws-onafterrender");bK("ws-var");A.foreachNotPreserved(bI,"[ws-on]",function(bL){bL.setAttribute("ws-on",bd.concat(" ",B.map(function(bM){var bN,bO,bP;bN=bd.SplitChars(bM,[":"],1);bO=(bP=null,[bJ.TryGetValue(B.get(bN,1),{get:function(){return bP;},set:function(bQ){bP=bQ;}}),bP]);return bO[0]?B.get(bN,0)+":"+bO[1]:bM;},bd.SplitChars(bL.getAttribute("ws-on"),[" "],1))));});A.foreachNotPreserved(bI,"[ws-attr-holes]",function(bL){var bM,bN,bO;bM=bd.SplitChars(bL.getAttribute("ws-attr-holes"),[" "],1);for(bN=0,bO=bM.length-1;bN<=bO;bN++)(function(){var bP;function bQ(bR,bS){var bT;bT=l.KeyValue(bS);return bR.replace(new a.RegExp("\\${"+bT[0]+"}","ig"),"${"+bT[1]+"}");}bP=B.get(bM,bN);return bL.setAttribute(bP,(((bF.Curried3(m.fold))(bQ))(bL.getAttribute(bP)))(bJ));}());});};_5.fill=function(bI,bJ,bK){while(true)if(bI.hasChildNodes())bK=bJ.insertBefore(bI.lastChild,bK);else return null;};_5.convertAttrs=function(bI){var bK,bL,bM,bN,bO,bP,bQ,bR;function bJ(bS){var bT;bT=bI.getAttribute(bS);if(bT===null);else bI.setAttribute(bS,bT.toLowerCase());}bK=bI.attributes;bL=[];bM=[];bN=[];for(bO=0,bP=bK.length-1;bO<=bP;bO++){bQ=bK.item(bO);if(bd.StartsWith(bQ.nodeName,"ws-on")&&bQ.nodeName!=="ws-onafterrender"&&bQ.nodeName!=="ws-on"){bL.push(bQ.nodeName);bM.push(_6.string(bQ.nodeName,{$:1,$0:"ws-on".length},null)+":"+bQ.nodeValue.toLowerCase());}else!bd.StartsWith(bQ.nodeName,"ws-")&&(new a.RegExp(A.TextHoleRE())).test(bQ.nodeValue)?(bQ.nodeValue=(bR=new a.RegExp(A.TextHoleRE(),"g"),bQ.nodeValue.replace(bR,function(bS,bT){return"${"+bT.toLowerCase()+"}";})),bN.push(bQ.nodeName)):void 0;}if(!(bM.length==0))bI.setAttribute("ws-on",bd.concat(" ",bM));if(!(bN.length==0))bI.setAttribute("ws-attr-holes",bd.concat(" ",bN));bJ("ws-hole");bJ("ws-replace");bJ("ws-attr");bJ("ws-onafterrender");bJ("ws-var");B.iter(function(bS){bI.removeAttribute(bS);},bL);};_6.string=function(bI,bJ,bK){var bL,bM;return bJ==null?bK!=null&&bK.$==1?(bL=bK.$0,bL<0?"":bI.slice(0,bL+1)):"":bK==null?bI.slice(bJ.$0):(bM=bK.$0,bM<0?"":bI.slice(bJ.$0,bM+1));};m.insufficient=function(){return l.FailWith("The input sequence has an insufficient number of elements.");};_7=L.KeyCollection=bF.Class({GetEnumerator$1:function(){return v.Get(m.map(function(bI){return bI.K;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},f,_7);_7.New=bF.Ctor(function(bI){f.New.call(this);this.d=bI;},_7);_8.get_UseAnimations=function(){return bh.UseAnimations();};_8.Play=function(bI){var bJ;bJ=null;return E.Delay(function(){return E.Bind(_8.Run(a.ignore,bh.Actions(bI)),function(){bh.Finalize(bI);return E.Return(null);});});};_8.Append=function(bI,bJ){return{$:0,$0:bs.Append(bI.$0,bJ.$0)};};_8.Run=function(bI,bJ){var bK;function bL(bM){function bN(bO){return function(bP){var bQ;bQ=bP-bO;bJ.Compute(bQ);bI();return bQ<=bK?void a.requestAnimationFrame(function(bR){(bN(bO))(bR);}):bM();};}a.requestAnimationFrame(function(bO){(bN(bO))(bO);});}bK=bJ.Duration;return bK===0?E.Zero():E.FromContinuations(function(bM,bN,bO){return bL.apply(null,[bM,bN,bO]);});};_8.Concat=function(bI){return{$:0,$0:bs.Concat(m.map(bh.List,bI))};};_8.get_Empty=function(){return{$:0,$0:bs.Empty()};};_9.BatchUpdatesEnabled=function(){bi.$cctor();return bi.BatchUpdatesEnabled;};_.StartProcessor=function(bI){var bJ;function bK(){var bL;bL=null;return E.Delay(function(){return E.Bind(bI,function(){var bM;bM=bJ[0];return r.Equals(bM,1)?(bJ[0]=0,E.Zero()):r.Equals(bM,2)?(bJ[0]=1,bK()):E.Zero();});});}bJ=[0];return function(){var bL;bL=bJ[0];if(r.Equals(bL,0)){bJ[0]=1;E.Start(bK(),null);}else r.Equals(bL,1)?bJ[0]=2:void 0;};};$.$cctor=function(){$.$cctor=a.ignore;$.noneCT=bk.New(false,[]);$.scheduler=new Y.New();$.defCTS=[new bl.New()];$.Zero=E.Return();$.GetCT=function(bI){bI.k({$:0,$0:bI.ct});};};bb.New=function(bI,bJ,bK,bL){var bM;bM={DynElem:bI,DynFlags:bJ,DynNodes:bK};bF.SetOptional(bM,"OnAfterRender",bL);return bM;};bc.$cctor=function(){var bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR;bc.$cctor=a.ignore;bc.EmptyAttr=null;bc.BoolCheckedApply=function(bS){function bT(bU,bV){return bV!=null&&bV.$==1?void(bU.checked=bV.$0):null;}return[function(bU){bU.addEventListener("change",function(){return!r.Equals(bS.Get(),bU.checked)?bS.Set(bU.checked):null;});},function(bU){return function(bV){return bT(bU,bV);};},q.Map(function(bU){return{$:1,$0:bU};},bS.get_View())];};bc.StringSet=function(bS){return function(bT){bS.value=bT;};};bc.StringGet=function(bS){return{$:1,$0:bS.value};};bc.StringApply=(bI=bn.StringGet(),(bJ=bn.StringSet(),function(bS){return bn.ApplyValue(bI,bJ,bS);}));bc.IntSetUnchecked=function(bS){return function(bT){bS.value=a.String(bT);};};bc.IntGetUnchecked=function(bS){var bT,bU;bT=bS.value;return bo.isBlank(bT)?{$:1,$0:0}:(bU=+bT,bU!==bU>>0?null:{$:1,$0:bU});};bc.IntApplyUnchecked=(bK=bn.IntGetUnchecked(),(bL=bn.IntSetUnchecked(),function(bS){return bn.ApplyValue(bK,bL,bS);}));bc.IntSetChecked=function(bS){return function(bT){var bU;bU=bT.get_Input();return bS.value!==bU?void(bS.value=bU):null;};};bc.IntGetChecked=function(bS){var bT,bU,bV;bT=bS.value;return{$:1,$0:bo.isBlank(bT)?(bS.checkValidity?bS.checkValidity():true)?new bp({$:2,$0:bT}):new bp({$:1,$0:bT}):(bU=(bV=0,[Q.TryParseInt32(bT,{get:function(){return bV;},set:function(bW){bV=bW;}}),bV]),bU[0]?new bp({$:0,$0:bU[1],$1:bT}):new bp({$:1,$0:bT}))};};bc.IntApplyChecked=(bM=bn.IntGetChecked(),(bN=bn.IntSetChecked(),function(bS){return bn.ApplyValue(bM,bN,bS);}));bc.FloatSetUnchecked=function(bS){return function(bT){bS.value=a.String(bT);};};bc.FloatGetUnchecked=function(bS){var bT,bU;bT=bS.value;return bo.isBlank(bT)?{$:1,$0:0}:(bU=+bT,a.isNaN(bU)?null:{$:1,$0:bU});};bc.FloatApplyUnchecked=(bO=bn.FloatGetUnchecked(),(bP=bn.FloatSetUnchecked(),function(bS){return bn.ApplyValue(bO,bP,bS);}));bc.FloatSetChecked=function(bS){return function(bT){var bU;bU=bT.get_Input();return bS.value!==bU?void(bS.value=bU):null;};};bc.FloatGetChecked=function(bS){var bT,bU;bT=bS.value;return{$:1,$0:bo.isBlank(bT)?(bS.checkValidity?bS.checkValidity():true)?new bp({$:2,$0:bT}):new bp({$:1,$0:bT}):(bU=+bT,a.isNaN(bU)?new bp({$:1,$0:bT}):new bp({$:0,$0:bU,$1:bT}))};};bc.FloatApplyChecked=(bQ=bn.FloatGetChecked(),(bR=bn.FloatSetChecked(),function(bS){return bn.ApplyValue(bQ,bR,bS);}));};bd.concat=function(bI,bJ){return B.ofSeq(bJ).join(bI);};bd.SplitChars=function(bI,bJ,bK){return bd.Split(bI,new a.RegExp("["+bd.RegexEscape(bJ.join(""))+"]"),bK);};bd.StartsWith=function(bI,bJ){return bI.substring(0,bJ.length)==bJ;};bd.Split=function(bI,bJ,bK){return bK===1?B.filter(function(bL){return bL!=="";},bd.SplitWith(bI,bJ)):bd.SplitWith(bI,bJ);};bd.RegexEscape=function(bI){return bI.replace(new a.RegExp("[-\\/\\\\^$*+?.()|[\\]{}]","g"),"\\$&");};bd.forall=function(bI,bJ){return m.forall(bI,bd.protect(bJ));};bd.SplitWith=function(bI,bJ){return bI.split(bJ);};bd.protect=function(bI){return bI===null?"":bI;};bf.New=function(bI,bJ){return{PreviousNodes:bI,Top:bJ};};bg.get_Empty=function(){return{$:0,$0:new V.New$3()};};bg.FindAll=function(bI){var bJ;function bK(bN,bO){var bP,bQ,bR,bS,bT;while(true)switch(bN){case 0:if(bO!=null&&bO.$==0){bQ=bO.$1;bR=bO.$0;bK(0,bR);bO=bQ;}else if(bO!=null&&bO.$==1){bS=bO.$0;bO=bS;bN=1;}else if(bO!=null&&bO.$==2){bT=bO.$0;bO=bT.Current;}else return bO!=null&&bO.$==6?(bP=bO.$0.Holes,(function(bU){return function(bV){B.iter(bU,bV);};}(bM))(bP)):null;break;case 1:bJ.push(bO);bO=bO.Children;bN=0;break;}}function bL(bN){return bK(0,bN);}function bM(bN){return bK(1,bN);}bJ=[];bL(bI);return{$:0,$0:new V.New$2(bJ)};};bg.Filter=function(bI,bJ){return{$:0,$0:bw.Filter(bI,bJ.$0)};};bg.Except=function(bI,bJ){return{$:0,$0:bw.Except(bI.$0,bJ.$0)};};bg.ToArray=function(bI){return bw.ToArray(bI.$0);};bg.Intersect=function(bI,bJ){return{$:0,$0:bw.Intersect(bI.$0,bJ.$0)};};bh.UseAnimations=function(){br.$cctor();return br.UseAnimations;};bh.Actions=function(bI){return bh.ConcatActions(B.choose(function(bJ){return bJ.$==1?{$:1,$0:bJ.$0}:null;},bs.ToArray(bI.$0)));};bh.Finalize=function(bI){B.iter(function(bJ){if(bJ.$==0)bJ.$0();},bs.ToArray(bI.$0));};bh.ConcatActions=function(bI){var bJ,bK,bL,bM;bJ=T.ofSeqNonCopying(bI);bK=B.length(bJ);return bK===0?bh.Const():bK===1?B.get(bJ,0):(bL=m.max(m.map(function(bN){return bN.Duration;},bJ)),(bM=B.map(function(bN){return bh.Prolong(bL,bN);},bJ),bh.Def(bL,function(bN){B.iter(function(bO){bO.Compute(bN);},bM);})));};bh.List=function(bI){return bI.$0;};bh.Const=function(bI){return bh.Def(0,function(){return bI;});};bh.Def=function(bI,bJ){return{Compute:bJ,Duration:bI};};bh.Prolong=function(bI,bJ){var bK,bL,bM;bK=bJ.Compute;bL=bJ.Duration;bM=bA.Create(function(){return bJ.Compute(bJ.Duration);});return{Compute:function(bN){return bN>=bL?bM.f():bK(bN);},Duration:bI};};bi.$cctor=function(){bi.$cctor=a.ignore;bi.BatchUpdatesEnabled=true;};bj.Clear=function(bI){bI.splice(0,B.length(bI));};bk.New=function(bI,bJ){return{c:bI,r:bJ};};bl=e.CancellationTokenSource=bF.Class({},f,bl);bl.New=bF.Ctor(function(){f.New.call(this);this.c=false;this.pending=null;this.r=[];this.init=1;},bl);bm.New=function(bI,bJ){return{k:bI,ct:bJ};};bn.ApplyValue=function(bI,bJ,bK){var bL;function bM(bN,bO){return bO==null?null:bN(bO.$0);}bL=null;return[function(bN){function bO(){bK.UpdateMaybe(function(bP){var bQ;bL=bI(bN);return bL!=null&&bL.$==1&&(!r.Equals(bL.$0,bP)&&(bQ=[bL,bL.$0],true))?bQ[0]:null;});}bN.addEventListener("change",bO);bN.addEventListener("input",bO);bN.addEventListener("keypress",bO);},function(bN){var bO;bO=bJ(bN);return function(bP){return bM(bO,bP);};},q.Map(function(bN){var bO;return bL!=null&&bL.$==1&&(r.Equals(bL.$0,bN)&&(bO=bL.$0,true))?null:{$:1,$0:bN};},bK.get_View())];};bn.StringSet=function(){bc.$cctor();return bc.StringSet;};bn.StringGet=function(){bc.$cctor();return bc.StringGet;};bn.IntSetUnchecked=function(){bc.$cctor();return bc.IntSetUnchecked;};bn.IntGetUnchecked=function(){bc.$cctor();return bc.IntGetUnchecked;};bn.IntSetChecked=function(){bc.$cctor();return bc.IntSetChecked;};bn.IntGetChecked=function(){bc.$cctor();return bc.IntGetChecked;};bn.FloatSetUnchecked=function(){bc.$cctor();return bc.FloatSetUnchecked;};bn.FloatGetUnchecked=function(){bc.$cctor();return bc.FloatGetUnchecked;};bn.FloatSetChecked=function(){bc.$cctor();return bc.FloatSetChecked;};bn.FloatGetChecked=function(){bc.$cctor();return bc.FloatGetChecked;};bo.isBlank=function(bI){return bd.forall(bu.IsWhiteSpace,bI);};bp=g.CheckedInput=bF.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,bp);bq.$cctor=function(){var bI;bq.$cctor=a.ignore;bq.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");bq.rtagName=new a.RegExp("<([\\w:]+)");bq.rhtml=new a.RegExp("<|&#?\\w+;");bq.wrapMap=(bI=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:bI,tbody:bI,tfoot:bI,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});bq.defaultWrap=[0,"",""];};br.$cctor=function(){br.$cctor=a.ignore;br.CubicInOut=bv.Custom(function(bI){var bJ;bJ=bI*bI;return 3*bJ-2*(bJ*bI);});br.UseAnimations=true;};bs.Append=function(bI,bJ){return bI.$==0?bJ:bJ.$==0?bI:{$:2,$0:bI,$1:bJ};};bs.ToArray=function(bI){var bJ;function bK(bL){var bM,bN;while(true)if(bL.$==1)return bJ.push(bL.$0);else if(bL.$==2){bM=bL.$1;bN=bL.$0;bK(bN);bL=bM;}else return bL.$==3?B.iter(function(bO){bJ.push(bO);},bL.$0):null;}bJ=[];bK(bI);return bJ.slice(0);};bs.Concat=function(bI){var bJ;bJ=T.ofSeqNonCopying(bI);return T.TreeReduce(bs.Empty(),bs.Append,bJ);};bs.Empty=function(){bB.$cctor();return bB.Empty;};bt.concat=function(bI){var bJ,bK;bJ=[];for(var bL in bI)bJ.push.apply(bJ,bI[bL]);return bJ;};bu.IsWhiteSpace=function(bI){return bI.match(new a.RegExp("\\s"))!==null;};Q.TryParse=function(bI,bJ,bK,bL){var bM,bN;bM=+bI;bN=bM===bM-bM%1&&bM>=bJ&&bM<=bK;if(bN)bL.set(bM);return bN;};bv=g.Easing=bF.Class({},f,bv);bv.Custom=function(bI){return new bv.New(bI);};bv.New=bF.Ctor(function(bI){f.New.call(this);this.transformTime=bI;},bv);bw.Filter=function(bI,bJ){return new V.New$2(B.filter(bI,bw.ToArray(bJ)));};bw.Except=function(bI,bJ){var bK;bK=new V.New$2(bw.ToArray(bJ));bK.ExceptWith(bw.ToArray(bI));return bK;};bw.ToArray=function(bI){var bJ;bJ=B.create(bI.get_Count(),void 0);bI.CopyTo(bJ);return bJ;};bw.Intersect=function(bI,bJ){var bK;bK=new V.New$2(bw.ToArray(bI));bK.IntersectWith(bw.ToArray(bJ));return bK;};bx.Children=function(bI,bJ){var bK,bL,bM;if(bJ!=null&&bJ.$==1){bM=[];bK=bJ.$0[0].nextSibling;while(bK!==bJ.$0[1]){bM.push(bK);bK=bK.nextSibling;}return{$:0,$0:bM};}else return{$:0,$0:B.init(bI.childNodes.length,(bL=bI.childNodes,function(bN){return bL[bN];}))};};bx.Except=function(bI,bJ){var bK;bK=bI.$0;return{$:0,$0:B.filter(function(bL){return B.forall(function(bM){return!(bL===bM);},bK);},bJ.$0)};};bx.Iter=function(bI,bJ){B.iter(bI,bJ.$0);};bx.DocChildren=function(bI){var bJ;function bK(bL){var bM,bN,bO,bP;while(true){if(bL!=null&&bL.$==2){bN=bL.$0;bL=bN.Current;}else if(bL!=null&&bL.$==1)return bJ.push(bL.$0.El);else if(bL==null)return null;else if(bL!=null&&bL.$==5)return bJ.push(bL.$0);else if(bL!=null&&bL.$==4)return bJ.push(bL.$0.Text);else if(bL!=null&&bL.$==6){bM=bL.$0.Els;return(function(bQ){return function(bR){B.iter(bQ,bR);};}(function(bQ){if(bQ==null||bQ.constructor===N)bK(bQ);else bJ.push(bQ);}))(bM);}else{bO=bL.$1;bP=bL.$0;bK(bP);bL=bO;}}}bJ=[];bK(bI.Children);return{$:0,$0:T.ofSeqNonCopying(bJ)};};bz=e.OperationCanceledException=bF.Class({},by,bz);bz.New=bF.Ctor(function(bI){bz.New$1.call(this,"The operation was canceled.",null,bI);},bz);bz.New$1=bF.Ctor(function(bI,bJ,bK){this.message=bI;this.inner=bJ;N.setPrototypeOf(this,bz.prototype);this.ct=bK;},bz);bA.Create=function(bI){return bD.New(false,bI,bA.forceLazy);};bA.forceLazy=function(){var bI;bI=this.v();this.c=true;this.v=bI;this.f=bA.cachedLazy;return bI;};bA.cachedLazy=function(){return this.v;};bB.$cctor=function(){bB.$cctor=a.ignore;bB.Empty={$:0};};bD.New=function(bI,bJ,bK){return{c:bI,v:bJ,f:bK};};bF.OnLoad(function(){c.Main();});}(self));


if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '/Content/';
  IntelliFactory.Runtime.Start();
}
